<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=ruby&amp;skin=desert"></script>
		<title>Dimension by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="logo">
							<span class="icon fa-fire"></span>
						</div>
						<div class="content">
							<div class="inner">
								<h1>The Floor Is Lava!</h1>
								<p> <b>The Perfect Foot Traffic Heat Mapping Utility</b><br><br>
										If you have ever struggled with:
										<br>inefficient retial layouts,
										<br>low inventory turnovers,
										<br>or nonstrategic product placement,
										<br>then click through below!

										<br> <b>Watch Me!!</b><br><br>
										<img src="images/pic03.jpg" height ="200" width = 200></img>
								</p>
							</div>
						</div>
						<nav>
							<ul>
								<li><a href="#intro"><b>Introduction</b></a></li>
								<li><a href="#work"><b>README PLS</b></a></li>
								<li><a href="#about"><b>About</b></a></li>
								<li><a href="#contact"><b>Impact Statement</b></a></li>
								<!--<li><a href="#elements">Elements</a></li>-->
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<div id="main">

						<!-- Intro -->
							<article id="intro">
								<h2 class="major">Intro</h2>
								<span class="image main"><img src="images/Store-Layout.png" alt="" /></span>
								<p>Looking at the image, we can see how an average retail store layout currently exists. Retailers are busy engaging with clients and having excellent customer service that it becomes a challenge and a cost to
								hire another employee to track customer foot traffic. You may have have had first-hand experience from this symptom as a customer struggling to find your product.  </p>
								<p>To help these retailers, we set out to create a software package that takes retail store video as input and produces useful information about the foot traffic and flow as output. Using this solution will help retailers maximize its revenue per square foot and be able to track visibility of its product promotions.</p>
								<p>Why "The Floor Is Lava": The name "The Floor is Lava" comes from the visual effect of the heatmap that makes it appear that the floor is lava.</p>
								<br>
								<h2>Project Evolution</h2>
								<p>From the start, we knew what project we wanted to do, and we talked about which skills each of us could bring to the table. Feeling that we could pull this off, all four of us began researching computer vision, image processing, and the ethics of our project idea. Issues were brought to our attention that led us to shy away from methods, such as facial recognition, that produced personally identifiable information from the images.
									<br><br>After the first architectural review, we began to experiment with all the methods we had uncovered and tested their ability to meet our needs. We picked a single method and Duncan and Gabriella began to iterate on it to meet our needs. Meanwhile, Nick collected sample footage from the Untitled Fashion Show, and Michael began to put together the project website you see here. Now that we were writing code that would become part of the final project, documentation became an important focus.<br> <br>After the second architectural review, we began the process of integrating the separate pieces of our project into a single cohesive unit.
									At the same time, we were documenting both the software and the project's story. Having a function minimum viable product (MVP) and enough supporting documents for others to understand our work were our goals for the final stretch.</p>
								<p>The video below is a demonstration of how the camera stream is recorded via web app and then displays a primitive heat map from where the object was; this will succeed with any footage stream.</p>
								<span class="image main"><video controls="controls" width="250" height="500" name="Video Name" src=images/demo.mov></video></span>
								<h2>Results</h2>
								<p>Using footage from the Weissman Foundry Fashion Show, we created a heat map outlining where individuals clustered around the most.There are two visuals, the video immediately below shows object tracking & heat mapping.
								<br><br>
								The video below shows the object tracking script able to successfully track and follow people along the catwalk. Additionally, the script shows how far it can detect individuals as well as its limiations with picking out people in a crowd. The number indicates the percent confindence such as .78 or .99.</p>
								<iframe style="padding:1px;border:1px solid black;" src="https://www.youtube.com/embed/VupkATc3i90" frameborder="1" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen width="560" height="315" align=middle></iframe></br></center>
								<br><br>
								Using this tracking video, we were then able to create a heat map feature utilizing the web app, and will appear below.
							</article>



						<!-- Work -->
							<article id="work">
								<h2 class="major">How To Run</h2>
								<span class="image main"><img src="images/lava.gif" height="200" width="50" alt="" /></span>
								<p>First you will need to clone the repo, The Floor is Lava, to your computer. Make sure you have the correct modules downloaded as specified in the README files. When launching this script, there are several steps that need to be taken.
It begins with the following..
								<ol>
									<li>Install the camera in the corner of the room at the highest possible point</li>
									<li>Next, we will hardwire the cameras to the main computer for future retrieval</li>
									<br><img align=middle src="images/web_app_welcome.png" alt=""/></span></br>
									<li>To begin streaming these videos and ensuring that the connections are working properly
we will open the web app. Detailed instruction on how to navigate throughout the web app are found below.</li>
									<br><img align=middle src="images/web_app_landing.png" height="250" width="400"  alt=""/></span></br>
									<br><h2>Software Architecture</h2>
									<li>To better understand how the scripts relate with each other, a diagram below shows how the scripts work together.
Super helpful for debugging.</li>
									<br><img align=middle src="images/diagram.png" height="400" width="400"  alt=""/></span></br>

								</ol>
								</p>
								</article>

						<!-- About -->
							<article id="about">
								<h2 class="major">About</h2>
								<p>So, you may be wondering, how does the code work? Let's begin with <b>app.py</b> script below that runs the Web App.
									These snipets display the packages being implemented and some of the function created to make this work.</p>
									<img src="images/Snipet1.png" alt="" height="400" width="500" ></img>
									<img src="images/Snipet2.png" alt="" height="400" width="500" ></img>
									<p> There are important classes that were integrated including a Heatmap, Stopwatch, ProcessingEngine that were created in order to frame it all together. See below.</p>
									<pre class="prettyprint">
"""
Contains all the classes used for computer vision and backend
processing.
@author: Duncan Mazza
@revision: v1.3
"""

import cv2
import cv2.aruco as aruco
from math import acos, cos, sin
import numpy as np
import time
import os

execution_path = os.getcwd()

DETECTION_THRESHOLD = 0.6
# minimum confidence level for person to be recognized


class Stopwatch:
"""
A utility for the calibrate() method of the ProcessingEngine
class; acts as a stopwatch.
"""

  def __init__(self):
      self.logged_time = time.time()
      self.time_since_last_check = 0

  def log_time(self):
  """
  Record the current time
  """
      self.logged_time = time.time()

  def check_stopwatch(self):
  """
  Check the elapsed time between when this method is called and
	when the stopwatch time was last logged.
  :return: self.time_since_last_check
  """
      self.time_since_last_check = time.time() - self.logged_time
      return self.time_since_last_check


class Heatmap:
"""
This class stores and renders the heatmaps generated
from the object detection in ProcessingEngine
"""

  def __init__(self):
      self.num_caps = 0  # number of captures (same as ProcessingEngine)
      self.heatmap_dict = {}  # dictionary to store the heatmaps
      self.cap_size_dict = {}  # dictionary to store the
			 resolution of the camera frames

  def add_heatmaps(self, cap_dict, num_caps):
  """
  Initializes empty heatmaps for each of the connected cameras
  :param cap_dict: dictionary of OpenCV captures
  :param num_caps:  number of captures in the dictionary
  :return: void
  """
      self.num_caps = num_caps
      for i in range(num_caps):
          cap = cap_dict[i][0]
          width = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))
          height = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
          print(width, height)
          self.heatmap_dict[i] = np.zeros((width, height))
          self.cap_size_dict[i] = (width, height)

  def add_to_heatmap(self, cap_num, box_points):
  """
  Add the points enclosed by a bounding box to the heatmap
  :param cap_num: index of the camera
  :param box_points: bounding box poitns (top left x, top left y,
	bottom right x, bottom right y)
  :return:
  """
      self.heatmap_dict[cap_num][box_points[1]:box_points[3],
			box_points[0]:box_points[2]] += 1

  def return_heatmap(self, cap_num):
  """
  Returns a matrix that will be interpreted by OpenCV and
	therefore the user as a heatmap
  :param cap_num:  index of the camera
  :return heatmap_img: a numpy.ndarray that is an
	image representing the heatmap
  """
      h = self.heatmap_dict[cap_num]  # retrieve the raw heatmap values
      h = np.interp(h, (0, h.max()), (0, 255))
			# rescale the heatmap to 0:255 values
      h = h.astype(np.uint8)  # convert data type for applyColorMap
      heatmap_img = cv2.applyColorMap(h, cv2.COLORMAP_HOT)
		  # turn matrix into a heatmap
      return heatmap_img

  def reset(self):
  """
  Resets the heatmaps using previously stored information about
	the camera's width and height
  :return: void
  """
      self.heatmap_dict = {}
      for i in range(self.num_caps):
          shape = self.cap_size_dict[i]
          self.heatmap_dict[i] = np.zeros(shape)

									</pre>

							</article>

						<!-- Contact -->
							<article id="contact">
								<h2>Impact Statement</h2>
								<p><b>Introduction</b><br>
We have created software with one clear intent: to provide information to retail shop owners about how shoppers move around inside their stores so that they may arrange their store to facilitate the flow of traffic and place products in profitable locations within the store. While this vision is not meant to cause harm to any of the stakeholders involved, we recognize that this software could be applied to different context or have additional consequences we did not foresee. This page serves as our recognition of the potential ethical problems surrounding our software and describes how we expect it to be used.</p>
								<p><b>Ethics of Video Recording</b><br>
								We feel that it is unethical to record someone without their consent; however, it is lawful in many U.S. states to record without consent.
								 That said, the footage collected for this project is video that would have existed regardless of the use of our
								 product because most stores have a security system that records the store. Recording for security purposes is common knowledge,
								  thanks in part to signs like this:
									<br><br>
									<img src="images/smile_on_camera.jpg" height="250" width="400" alt=""><br><br>
								Given that people are generally aware of being recorded, we propose that signage be posted informing them of how security footage is further used in stores that use our product. This informs them that they are being recorded and to what extent that footage is used beyond what they already know. In this fashion,
								we feel we have sufficiently mitigated the ethical risks of using recorded footage of people whose consent is only implied.</p>

								<p><b>Ethics of Recognition</b><br>
First and foremost, our software does not intend to identify people or create personally identifiable information. Second, recognition softwares have historically encountered problems with diversity and inclusion because they were published before their limitations were fully understood. As it stands now, our software carries all the limitations of the recognition dataset from which it was trained, and we have not yet characterized its ability to accurately recognize people who have darker skin, are wheelchair bound, or otherwise different in physical appearance to a camera. <br>We plan to gather this information to prevent blind trust in our algorithm, but also recognize that our software may not have a wide enough impact for these limitations to become significant.
<b> Just in case,this software has not been shown to inclusively recognize people with all physical appearances</b> and any application must recognize this limitation.</p>
								<p><b>Conclusion</b><br>
To summarize, we foresee risks relating to recording shoppers and recognizing people of all kinds in the application of our software.
We recognize that there may be other consequences that we have not foreseen, but do not expect our software to be so widely applied that these miscomings cause widespread harm.



								<h2>Attribution & Credits </h2>
									<p>
										<ol>
												<li><a href="https://pjreddie.com/darknet/yolo/">YOLO</a> </li>
												<li><a href="https://opencv.org/">OpenCV</a></li>
												<li></li>
												<li></li>
												<li></li>

										</ol>
									</p>
							</article>
						<!-- Elements -->
							<article id="elements">
								<h2 class="major">Elements</h2>

								<section>
									<h3 class="major">Text</h3>
									<p>This is <b>bold</b> and this is <strong>strong</strong>. This is <i>italic</i> and this is <em>emphasized</em>.
									This is <sup>superscript</sup> text and this is <sub>subscript</sub> text.
									This is <u>underlined</u> and this is code: <code>for (;;) { ... }</code>. Finally, <a href="#">this is a link</a>.</p>
									<hr />
									<h2>Heading Level 2</h2>
									<h3>Heading Level 3</h3>
									<h4>Heading Level 4</h4>
									<h5>Heading Level 5</h5>
									<h6>Heading Level 6</h6>
									<hr />
									<h4>Blockquote</h4>
									<blockquote>Fringilla nisl. Donec accumsan interdum nisi, quis tincidunt felis sagittis eget tempus euismod. Vestibulum ante ipsum primis in faucibus vestibulum. Blandit adipiscing eu felis iaculis volutpat ac adipiscing accumsan faucibus. Vestibulum ante ipsum primis in faucibus lorem ipsum dolor sit amet nullam adipiscing eu felis.</blockquote>
									<h4>Preformatted</h4>
									<pre><code>i = 0;

while (!deck.isInOrder()) {
    print 'Iteration ' + i;
    deck.shuffle();
    i++;
}

print 'It took ' + i + ' iterations to sort the deck.';</code></pre>
								</section>

								<section>
									<h3 class="major">Lists</h3>

									<h4>Unordered</h4>
									<ul>
										<li>Dolor pulvinar etiam.</li>
										<li>Sagittis adipiscing.</li>
										<li>Felis enim feugiat.</li>
									</ul>

									<h4>Alternate</h4>
									<ul class="alt">
										<li>Dolor pulvinar etiam.</li>
										<li>Sagittis adipiscing.</li>
										<li>Felis enim feugiat.</li>
									</ul>

									<h4>Ordered</h4>
									<ol>
										<li>Dolor pulvinar etiam.</li>
										<li>Etiam vel felis viverra.</li>
										<li>Felis enim feugiat.</li>
										<li>Dolor pulvinar etiam.</li>
										<li>Etiam vel felis lorem.</li>
										<li>Felis enim et feugiat.</li>
									</ol>
									<h4>Icons</h4>
									<ul class="icons">
										<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
									</ul>

									<h4>Actions</h4>
									<ul class="actions">
										<li><a href="#" class="button primary">Default</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
									<ul class="actions stacked">
										<li><a href="#" class="button primary">Default</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
								</section>

								<section>
									<h3 class="major">Table</h3>
									<h4>Default</h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Name</th>
													<th>Description</th>
													<th>Price</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Item One</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Two</td>
													<td>Vis ac commodo adipiscing arcu aliquet.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Three</td>
													<td> Morbi faucibus arcu accumsan lorem.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Four</td>
													<td>Vitae integer tempus condimentum.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Five</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
											</tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td>100.00</td>
												</tr>
											</tfoot>
										</table>
									</div>

									<h4>Alternate</h4>
									<div class="table-wrapper">
										<table class="alt">
											<thead>
												<tr>
													<th>Name</th>
													<th>Description</th>
													<th>Price</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Item One</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Two</td>
													<td>Vis ac commodo adipiscing arcu aliquet.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Three</td>
													<td> Morbi faucibus arcu accumsan lorem.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Four</td>
													<td>Vitae integer tempus condimentum.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Five</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
											</tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td>100.00</td>
												</tr>
											</tfoot>
										</table>
									</div>
								</section>

								<section>
									<h3 class="major">Buttons</h3>
									<ul class="actions">
										<li><a href="#" class="button primary">Primary</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
									<ul class="actions">
										<li><a href="#" class="button">Default</a></li>
										<li><a href="#" class="button small">Small</a></li>
									</ul>
									<ul class="actions">
										<li><a href="#" class="button primary icon fa-download">Icon</a></li>
										<li><a href="#" class="button icon fa-download">Icon</a></li>
									</ul>
									<ul class="actions">
										<li><span class="button primary disabled">Disabled</span></li>
										<li><span class="button disabled">Disabled</span></li>
									</ul>
								</section>

								<section>
									<h3 class="major">Form</h3>
									<form method="post" action="#">
										<div class="fields">
											<div class="field half">
												<label for="demo-name">Name</label>
												<input type="text" name="demo-name" id="demo-name" value="" placeholder="Jane Doe" />
											</div>
											<div class="field half">
												<label for="demo-email">Email</label>
												<input type="email" name="demo-email" id="demo-email" value="" placeholder="jane@untitled.tld" />
											</div>
											<div class="field">
												<label for="demo-category">Category</label>
												<select name="demo-category" id="demo-category">
													<option value="">-</option>
													<option value="1">Manufacturing</option>
													<option value="1">Shipping</option>
													<option value="1">Administration</option>
													<option value="1">Human Resources</option>
												</select>
											</div>
											<div class="field half">
												<input type="radio" id="demo-priority-low" name="demo-priority" checked>
												<label for="demo-priority-low">Low</label>
											</div>
											<div class="field half">
												<input type="radio" id="demo-priority-high" name="demo-priority">
												<label for="demo-priority-high">High</label>
											</div>
											<div class="field half">
												<input type="checkbox" id="demo-copy" name="demo-copy">
												<label for="demo-copy">Email me a copy</label>
											</div>
											<div class="field half">
												<input type="checkbox" id="demo-human" name="demo-human" checked>
												<label for="demo-human">Not a robot</label>
											</div>
											<div class="field">
												<label for="demo-message">Message</label>
												<textarea name="demo-message" id="demo-message" placeholder="Enter your message" rows="6"></textarea>
											</div>
										</div>
										<ul class="actions">
											<li><input type="submit" value="Send Message" class="primary" /></li>
											<li><input type="reset" value="Reset" /></li>
										</ul>
									</form>
								</section>

							</article>

					</div>
				<!-- Footer -->
					<footer id="footer">
						<p class="copyright">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
					</footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
